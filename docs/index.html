<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>一个测试网站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      padding: 20px;
      font-family: Arial, sans-serif;
    }

    textarea {
      margin: 4px auto;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #fff;
      padding: 8px;
      font-size: 14px;
    }

    input {
      width: 100%;
      margin: 4px auto;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #fff;
      padding: 8px;
      font-size: 14px;
    }

    select {
        padding: 8px;
        width: 100%;
        margin: 4px auto;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: #fff;
        color: #333;
        font-size: 14px;
    }

    .fill_width {
      width: 100%;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }



    @media (max-width: 600px) {
      body {}
    }
  </style>
</head>

<body>
  <h2>助手Scheme测试页面</h2>
  <p>在输入框里输入打开助手的Scheme然后点击打开链接</p>
  <textarea type="text" id="myInput" rows="4" placeholder="输入打开助手的scheme"></textarea>
  <div>
    <button onclick="openSchemeLink()">打开链接</button>
    <button onclick="clearSchemeInput()">清空</button>
  </div>

  <p>测试OpenButton</p>

  <select id="inputScheme"  class="fill_width">
    <option disabled selected value="">选择要打开助手的Scheme</option>
  </select>

  <select id="inputType"  class="fill_width">
    <option disabled selected value="">type, OpenButton的type,比如10003表示打开网页</option>
  </select>


  <!-- <input type="text" id="inputScheme" placeholder="scheme, 比如:cfpage" /> -->
  <!-- <input type="text" id="inputType" placeholder="type, OpenButton的type,比如10003表示打开网页" /> -->
  <textarea type="text" id="inputUri" rows="4" placeholder="uri, OpenButton的uri，不同的type有不同的类型, 10003这里应该填网页地址，10042这里应该填flutter路由地址" ></textarea>
  <textarea type="text" id="inputParams" rows="4" placeholder='params，必须是json格式，比如:{"key":value, "key2": 22}'></textarea>
  <textarea type="text" id="inputOtherParams" rows="4" placeholder='others，和button同一级的其他参数，必须是json格式，比如:{"key":value, "key2": 22}'></textarea>

  <div>
    <button onclick="openButton()">OpenButton</button>
    <button onclick="clearInput()">Clear</button>
  </div>




  <script>

    // 一些工具函数

    // 获取输入框的值
    function getInputValue(id) {
      return document.getElementById(id).value;
    }

    // 设置输入框的值
    function setInputValue(id, value) {
      let input = document.getElementById(id)
      input.value = value;
      return input;
    }

    // 给action添加选项
  function addSelectOption(selectId, value, text) {
      let select = document.getElementById(selectId)
      let option = document.createElement('option');
      option.value = value;
      option.text = text;
      select.appendChild(option);
      return option;
    }



    function openSchemeLink() {
      // 获取输入框的值
      let url = getInputValue('myInput');
      localStorage.setItem("myInput", url)
      if (url.length > 0) {
        // 打开新的窗口或标签页
        window.open(url, '_blank');
      }
    }

    function clearSchemeInput() {
      setInputValue('myInput', "").focus();
    }


    function openButton() {

      let scheme = getInputValue("inputScheme");
      let type = getInputValue("inputType");
      let uri = getInputValue("inputUri");
      let params = getInputValue("inputParams");
      let otherParams = getInputValue("inputOtherParams");



      // 保存输入框的值
      localStorage.setItem("inputScheme", scheme);
      localStorage.setItem("inputType", type);
      localStorage.setItem("inputUri", uri);
      localStorage.setItem("inputParams", params);

      console.log(params);

      let button = {
        type: type,
        uri: uri,
        param: params
      };

      if (otherParams.length > 0) {
        otherParams = JSON.parse(otherParams);
      }

      button = Object.assign(button, otherParams);


      console.log(`button: ${button}`);

      scheme = `${scheme}://webopenapi/startApp?action=20003&button=${encodeURIComponent(JSON.stringify(button))}`;
      window.open(scheme, '_blank');

    }

    function clearInput() {
      setInputValue("inputScheme", "");
      setInputValue("inputType", "");
      setInputValue("inputUri", "");
      setInputValue("inputParams", "");

      localStorage.clear();
    }

    (function () {

      // 给scheme输入添加选择框
      let schemes = {
        "cfpage": 'cf(cfpage://)',
        "dnfgamehelper": 'dnf(dnfgamehelper://)',
        "speedgamehelper": 'speed(speedgamehelper://)',
        "lostarkgamehelper": 'lostark(lostarkgamehelper://)'
      }

      for (let key in schemes) {
        addSelectOption('inputScheme', key, schemes[key]);
      }
      

      // type
      let types = {
        '10001': '打开活动(10001)',
        '10002': '资讯列表(10002)',
        '10003': '普通网页(10003)',
        '10004': '普通网页，要验证角色(10004)',
        '10032': '顶部带切角色按钮的网页(10032)',
        '10033': '底部带切角色按钮的网页(10033)',
        '10005': '本地路由(10005)',
        '10015': '个人主页(10015)',
        '10019': '切换首页底栏(10019)',
        '10020': '打开聊天室(10020)',
        '10021': '打开特定的游戏(10021)',
        '10026': '打开圈子(10026)',
        '10030': '打开私聊(10030)',
        '10042': '打开Flutter页面(10042)',
        '10044': '启动游戏(10044)',
        
      }

      for (let key in types) {
        addSelectOption('inputType', key, types[key]);
      }
      

      setInputValue('myInput', localStorage.getItem("myInput"));

      let savedScheme = localStorage.getItem("inputScheme");
      if (savedScheme !== null) {
        setInputValue('inputScheme', localStorage.getItem("inputScheme"));
      }
      
      let savedType = localStorage.getItem("inputType");
      if (savedType != null) {
        setInputValue('inputType', localStorage.getItem("inputType"));
      }

      setInputValue('inputUri', localStorage.getItem("inputUri"));
      setInputValue('inputParams', localStorage.getItem("inputParams"));


    })();

  

  </script>
</body>

</html>